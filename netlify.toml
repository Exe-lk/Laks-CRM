[build]
  command = "yarn build"
  publish = ".next"

[functions]
  # Use esbuild for faster bundling and smaller function sizes
  node_bundler = "esbuild"
  
  # Set the Node.js version for functions
  node_version = "18"

# Environment variable configuration
# Note: Variables prefixed with NEXT_PUBLIC_ are automatically available
# at build time and embedded in the client bundle. They don't need to
# be passed to Lambda functions, which helps reduce the 4KB limit.

# For optimal deployment:
# 1. In Netlify Dashboard → Site settings → Environment variables:
#    - Set all NEXT_PUBLIC_* variables to "Build-time only" scope
#    - This prevents them from being passed to Lambda functions
#
# 2. Only runtime variables needed by API routes should be available
#    to functions. These include:
#    - DATABASE_URL
#    - DIRECT_URL
#    - FIREBASE_PROJECT_ID
#    - FIREBASE_CLIENT_EMAIL
#    - FIREBASE_PRIVATE_KEY
#    - SUPABASE_SERVICE_ROLE_KEY
#    - Function secrets (CUSTOMER_FUNCTION_SECRET, etc.)
#
# 3. Consider using Netlify's environment variable scoping feature
#    to further reduce the size passed to Lambda functions

# Headers configuration (if needed for your service worker)
[[headers]]
  for = "/firebase-messaging-sw.js"
  [headers.values]
    Content-Type = "application/javascript"
    Service-Worker-Allowed = "/"
    Cache-Control = "public, max-age=0, must-revalidate"

